<?php

/**
 * PluginDmPageView
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 *
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 5845 2009-06-09 07:36:57Z jwage $
 */
abstract class PluginDmPageView extends BaseDmPageView
{

  public function preSave($event)
  {
    parent::preSave($event);

    $this->createTemplate();
  }

  protected function createTemplate()
  {
    $file = $this->getTemplateFile();
    $defaultFile = dm::getDir().'/dmFrontPlugin/modules/dmFront/templates/defaultPageViewSuccess.php';

    if(!file_exists($file))
    {
      if($filesystem = $this->getService('filesystem'))
      {
        $filesystem->mkdir(dirname($file));
      }
      
      if(!copy($defaultFile, $file))
      {
        throw new RuntimeException('Can not write page view template to '.dmProject::unRootify($file).', please check permissions');
      }
    }
  }

  public function getTemplateFile()
  {
    return sfConfig::get('sf_root_dir').'/apps/front/modules/dmFront/templates/'.$this->get('template').'Success.php';
  }

  public function renameForModuleAndAction($module, $action)
  {
    $this->name = sprintf('%s.%s', $module, $action);
  }

}